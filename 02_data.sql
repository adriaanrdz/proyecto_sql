-- =====================================================
-- 02_data.sql - Inserción de datos de prueba
-- =====================================================

USE retail_sales_db;

-- Iniciamos la transacción
START TRANSACTION;
-- -----------------------------------------------------
-- DIM_PROVINCE
-- -----------------------------------------------------
INSERT INTO dim_province (province_name)
VALUES
('Madrid'),
('Barcelona'),
('Sevilla'),
('Valencia'),
('Bilbao');

-- -----------------------------------------------------
-- DIM_STORE
-- Tiendas físicas desordenadas
-- -----------------------------------------------------
INSERT INTO dim_store (store_name, province_id, opening_date)
VALUES
('El Carmen', 4, '2022-07-30'),        -- Valencia
('Macarena', 3, '2021-08-10'),        -- Sevilla
('Sant Andreu', 2, '2022-02-28'),     -- Barcelona
('Madrid Centro', 1, '2022-01-15'),   -- Madrid
('Indautxu', 5, '2022-09-18'),        -- Bilbao
('Ruzafa', 4, '2023-02-15'),          -- Valencia
('Gracia', 2, '2022-11-01'),          -- Barcelona
('Triana', 3, '2020-03-05'),          -- Sevilla
('Madrid Norte', 1, '2023-05-10'),    -- Madrid
('Casco Viejo', 5, '2020-12-01'),     -- Bilbao
('Deusto', 5, '2021-06-05'),          -- Bilbao
('Campanar', 4, '2021-11-25'),        -- Valencia
('Barceloneta', 2, '2023-03-15'),     -- Barcelona
('Los Remedios', 3, '2023-01-20'),    -- Sevilla
('Nervión', 3, '2022-04-18'),         -- Sevilla
('Madrid Sur', 1, '2021-09-05'),      -- Madrid
('Abando', 5, '2022-03-10'),          -- Bilbao
('Madrid Este', 1, '2022-06-12'),     -- Madrid
('Eixample', 2, '2021-07-20'),        -- Barcelona
('Ciutat Vella', 4, '2021-05-12');    -- Valencia

-- -----------------------------------------------------
-- DIM_CATEGORY
-- Clasificación de productos electrónicos
-- -----------------------------------------------------
INSERT INTO dim_category (category_name)
VALUES
('Móviles'),
('PC'),
('Accesorios'),
('Audio'),
('Smart Home');

-- -----------------------------------------------------
-- DIM_PRODUCT
-- Productos de electrónica, mezclados y variados
-- Total: 25 productos
-- -----------------------------------------------------
INSERT INTO dim_product (product_name, category_id, unit_price)
VALUES
('iPhone 14 Pro', 1, 1299.00),           
('Cargador Anker 20W', 3, 25.99),       
('Portátil Dell XPS 15', 2, 1599.00),   
('AirPods Pro', 4, 279.99),             
('Funda iPhone 14 Pro', 3, 39.90),      
('Samsung Galaxy S23', 1, 999.99),      
('Cámara Ring Indoor', 5, 129.99),      
('MacBook Air M2', 2, 1249.00),         
('Altavoz JBL Flip 6', 4, 149.99),      
('Google Pixel 7', 1, 649.00),          
('Enchufe Inteligente TP-Link', 5, 34.99), 
('Powerbank Xiaomi 20000mAh', 3, 49.99), 
('Termostato Nest', 5, 249.00),         
('Bose QuietComfort 45', 4, 329.00),    
('Cable USB-C Samsung', 3, 15.50),      
('HomePod Mini', 4, 99.00),             
('Monitor Samsung 27"', 2, 299.99),     
('Bombilla Philips Hue', 5, 49.95),     
('Tablet iPad Air', 2, 599.00),         
('Cámara GoPro Hero 10', 5, 399.00),    
('Teclado Mecánico Logitech', 3, 89.99),
('Smartwatch Apple Watch 8', 1, 499.00),
('Altavoz Sonos One', 4, 229.00),
('Laptop HP Pavilion', 2, 799.99),
('Auriculares Sony WH-1000XM5', 4, 349.00);

-- -----------------------------------------------------
-- DIM_CALENDAR para diciembre 2025
-- -----------------------------------------------------
INSERT INTO dim_calendar (date_id, day, month, year)
VALUES
('2025-12-01', 1, 12, 2025),
('2025-12-02', 2, 12, 2025),
('2025-12-03', 3, 12, 2025),
('2025-12-04', 4, 12, 2025),
('2025-12-05', 5, 12, 2025),
('2025-12-06', 6, 12, 2025),
('2025-12-07', 7, 12, 2025),
('2025-12-08', 8, 12, 2025),
('2025-12-09', 9, 12, 2025),
('2025-12-10', 10, 12, 2025),
('2025-12-11', 11, 12, 2025),
('2025-12-12', 12, 12, 2025),
('2025-12-13', 13, 12, 2025),
('2025-12-14', 14, 12, 2025),
('2025-12-15', 15, 12, 2025),
('2025-12-16', 16, 12, 2025),
('2025-12-17', 17, 12, 2025),
('2025-12-18', 18, 12, 2025),
('2025-12-19', 19, 12, 2025),
('2025-12-20', 20, 12, 2025),
('2025-12-21', 21, 12, 2025),
('2025-12-22', 22, 12, 2025),
('2025-12-23', 23, 12, 2025),
('2025-12-24', 24, 12, 2025),
('2025-12-25', 25, 12, 2025),
('2025-12-26', 26, 12, 2025),
('2025-12-27', 27, 12, 2025),
('2025-12-28', 28, 12, 2025),
('2025-12-29', 29, 12, 2025),
('2025-12-30', 30, 12, 2025),
('2025-12-31', 31, 12, 2025);

-- =====================================================
-- INSERT EN fact_sales - 100 VENTAS
-- =====================================================

INSERT INTO fact_sales (product_id, store_id, date_id, quantity, unit_price, total_amount)
VALUES
(1, 1, '2025-12-01', 1, 1299.00, 1299.00),
(5, 2, '2025-12-01', 2, 39.90, 79.80),
(9, 3, '2025-12-02', 1, 149.99, 149.99),
(13, 4, '2025-12-03', 4, 249.00, 996.00),
(2, 5, '2025-12-03', 1, 25.99, 25.99),
(7, 6, '2025-12-03', 2, 129.99, 259.98),
(11, 7, '2025-12-04', 1, 34.99, 34.99),
(3, 8, '2025-12-05', 1, 1599.00, 1599.00),
(15, 9, '2025-12-05', 3, 15.50, 46.50),
(18, 10, '2025-12-06', 2, 49.95, 99.90),
(4, 11, '2025-12-06', 1, 279.99, 279.99),
(8, 12, '2025-12-07', 3, 1249.00, 3747.00),
(12, 13, '2025-12-07', 2, 49.99, 99.98),
(16, 14, '2025-12-08', 1, 99.00, 99.00),
(20, 15, '2025-12-08', 1, 399.00, 399.00),
(6, 1, '2025-12-09', 2, 999.99, 1999.98),
(14, 2, '2025-12-09', 3, 329.00, 987.00),
(19, 3, '2025-12-10', 1, 49.95, 49.95),
(10, 4, '2025-12-10', 2, 649.00, 1298.00),
(17, 5, '2025-12-11', 1, 299.99, 299.99),
(21, 6, '2025-12-11', 2, 499.00, 998.00),
(22, 7, '2025-12-12', 1, 229.00, 229.00),
(23, 8, '2025-12-12', 3, 799.99, 2399.97),
(24, 9, '2025-12-12', 1, 799.99, 799.99),
(25, 10, '2025-12-13', 2, 349.00, 698.00),
(1, 11, '2025-12-13', 1, 1299.00, 1299.00),
(5, 12, '2025-12-14', 3, 39.90, 119.70),
(9, 13, '2025-12-14', 1, 149.99, 149.99),
(13, 14, '2025-12-14', 2, 249.00, 498.00),
(2, 15, '2025-12-15', 1, 25.99, 25.99),
(7, 1, '2025-12-15', 1, 129.99, 129.99),
(11, 2, '2025-12-16', 2, 34.99, 69.98),
(3, 3, '2025-12-16', 1, 1599.00, 1599.00),
(15, 4, '2025-12-16', 2, 15.50, 31.00),
(18, 5, '2025-12-16', 1, 49.95, 49.95),
(4, 6, '2025-12-17', 3, 279.99, 839.97),
(8, 7, '2025-12-17', 1, 1249.00, 1249.00),
(12, 8, '2025-12-17', 2, 49.99, 99.98),
(16, 9, '2025-12-18', 1, 99.00, 99.00),
(20, 10, '2025-12-18', 2, 399.00, 798.00),
(6, 11, '2025-12-19', 1, 999.99, 999.99),
(14, 12, '2025-12-19', 3, 329.00, 987.00),
(19, 13, '2025-12-19', 2, 49.95, 99.90),
(10, 14, '2025-12-20', 1, 649.00, 649.00),
(17, 15, '2025-12-20', 2, 299.99, 599.98),
(21, 1, '2025-12-21', 1, 499.00, 499.00),
(22, 2, '2025-12-21', 2, 229.00, 458.00),
(23, 3, '2025-12-21', 1, 799.99, 799.99),
(24, 4, '2025-12-21', 3, 799.99, 2399.97),
(25, 5, '2025-12-22', 1, 349.00, 349.00),
(1, 6, '2025-12-22', 2, 1299.00, 2598.00),
(5, 7, '2025-12-22', 1, 39.90, 39.90),
(9, 8, '2025-12-22', 3, 149.99, 449.97),
(13, 9, '2025-12-22', 2, 249.00, 498.00),
(2, 10, '2025-12-23', 1, 25.99, 25.99),
(7, 11, '2025-12-23', 2, 129.99, 259.98),
(11, 12, '2025-12-23', 1, 34.99, 34.99),
(3, 13, '2025-12-23', 1, 1599.00, 1599.00),
(15, 14, '2025-12-23', 2, 15.50, 31.00),
(18, 15, '2025-12-23', 1, 49.95, 49.95),
(4, 1, '2025-12-24', 3, 279.99, 839.97),
(8, 2, '2025-12-24', 1, 1249.00, 1249.00),
(12, 3, '2025-12-24', 2, 49.99, 99.98),
(16, 4, '2025-12-24', 1, 99.00, 99.00),
(20, 5, '2025-12-24', 2, 399.00, 798.00),
(6, 6, '2025-12-24', 1, 999.99, 999.99),
(14, 7, '2025-12-24', 3, 329.00, 987.00),
(19, 8, '2025-12-24', 2, 49.95, 99.90),
(10, 9, '2025-12-25', 1, 649.00, 649.00),
(17, 10, '2025-12-25', 2, 299.99, 599.98),
(21, 11, '2025-12-26', 1, 499.00, 499.00),
(22, 12, '2025-12-26', 2, 229.00, 458.00),
(23, 13, '2025-12-26', 1, 799.99, 799.99),
(24, 14, '2025-12-27', 3, 799.99, 2399.97),
(25, 15, '2025-12-27', 1, 349.00, 349.00),
(1, 1, '2025-12-27', 2, 1299.00, 2598.00),
(5, 2, '2025-12-28', 1, 39.90, 39.90),
(9, 3, '2025-12-28', 3, 149.99, 449.97),
(13, 4, '2025-12-28', 2, 249.00, 498.00),
(2, 5, '2025-12-28', 1, 25.99, 25.99),
(7, 6, '2025-12-28', 2, 129.99, 259.98),
(11, 7, '2025-12-29', 1, 34.99, 34.99),
(3, 8, '2025-12-29', 1, 1599.00, 1599.00),
(15, 9, '2025-12-29', 2, 15.50, 31.00),
(18, 10, '2025-12-29', 1, 49.95, 49.95),
(4, 11, '2025-12-30', 3, 279.99, 839.97),
(8, 12, '2025-12-30', 1, 1249.00, 1249.00),
(12, 13, '2025-12-30', 2, 49.99, 99.98),
(16, 14, '2025-12-30', 1, 99.00, 99.00),
(20, 15, '2025-12-30', 2, 399.00, 798.00),
(6, 1, '2025-12-31', 1, 999.99, 999.99),
(14, 2, '2025-12-31', 3, 329.00, 987.00),
(19, 3, '2025-12-31', 2, 49.95, 99.90),
(10, 4, '2025-12-31', 1, 649.00, 649.00),
(17, 5, '2025-12-31', 2, 299.99, 599.98),
(21, 6, '2025-12-31', 1, 499.00, 499.00),
(22, 7, '2025-12-31', 2, 229.00, 458.00),
(23, 8, '2025-12-31', 1, 799.99, 799.99),
(24, 9, '2025-12-31', 3, 799.99, 2399.97),
(25, 10, '2025-12-31', 1, 349.00, 349.00);
-- -----------------------------------------------------
-- COMMIT: Guardamos los cambios si todo fue correcto
-- -----------------------------------------------------
COMMIT;

-- =====================================================
-- UPDATE y DELETE de ejemplo
-- =====================================================

-- Iniciamos la transacción
START TRANSACTION;

-- -----------------------------------------------------
-- UPDATE: Oferta navideña 20% en 'PC Gaming' del 26 al 31 diciembre
-- Solo afecta a fact_sales, para no alterar el histórico de precios
-- -----------------------------------------------------
UPDATE fact_sales fs
JOIN dim_product dp ON fs.product_id = dp.product_id
SET fs.unit_price = ROUND(fs.unit_price * 0.8,2),	-- aplicamos 20% descuento
	fs.total_amount= ROUND(fs.total_amount * 0.8,2)
WHERE dp.product_name = 'Portátil Dell XPS 15'
AND fs.date_id BETWEEN '2025-12-26' AND '2025-12-31';

-- -----------------------------------------------------
-- DELETE: Eliminamos una venta de prueba que se registró mal
-- -----------------------------------------------------
DELETE FROM fact_sales
WHERE sale_id = 10;  -- ejemplo, eliminar venta concreta

-- -----------------------------------------------------
-- COMMIT: Guardamos los cambios si todo fue correcto
-- -----------------------------------------------------
COMMIT;

-- -----------------------------------------------------
-- Nota: si algo falla, se podría usar ROLLBACK para deshacer
-- -----------------------------------------------------
-- ROLLBACK;
